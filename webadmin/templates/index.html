{% extends "base.html" %}
{% block title %}JJ Clock - Home{% endblock %}
{% block js %}
  <script>
    function updateall() {
      updatestatus()
    }
    function updatestatus() {
      var xhttp = new XMLHttpRequest();
      xhttp.open("GET", "api/status", true);
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          jr = JSON.parse(this.responseText);
          console.log(jr)
          if ("gps" in jr) {
            document.getElementById("fixspan").classList.remove("bg-warning", "bg-danger", "bg-success")
            document.getElementById("timespan").classList.remove("bg-warning", "bg-danger", "bg-success")
            if (jr["gps"]["hasfix"] == true) {
              document.getElementById("fixspan").classList.add("bg-success")
            } else {
              document.getElementById("fixspan").classList.add("bg-danger")
            }
            if (jr["gps"]["hastime"] == true) {
              document.getElementById("timespan").classList.add("bg-success")
            } else {
              document.getElementById("timespan").classList.add("bg-danger")
            }
            document.getElementById("gpsloccell").innerHTML = jr["gps"]["loc"]
            document.getElementById("gpstimecell").innerHTML = jr["gps"]["dtutc"]
            document.getElementById("gpstzcell").innerHTML = jr["gps"]["tz"]
          }
          if ("timestamp" in jr) {
            document.getElementById("timecell").innerHTML = jr["timestamp"]
          }
          if ("tz" in jr) {
            document.getElementById("tzcell").innerHTML = jr["tz"]
          }
        }      
      }
      xhttp.send()
    }
  </script>
{% endblock %}
{% block content %}
<div class="row mt-3 border">
  <img src="/api/screen.png" class="col-12 img-fluid">
</div>
<div class="row mt-3 border">
  <div class="col-12 mt-3">
    <h2>Status:</h2>
  </div>
  <div class="col-12 mt-0 mb-0">
    <table class="table">
      <colgroup>
        <col class="col-auto">
        <col class="col">
      </colgroup>
      <tr>
        <th scope="row">Time:</th>
        <td id="timecell">unknown</td>
      </tr>
      <tr>
        <th scope="row">Timezone:</th>
        <td id="tzcell">unknown</td>
      </tr>     
      <tr>
        <th scope="row">GPS Status:</th>
        <td id="gpsstatuscell"><span class="badge bg-warning" id="fixspan">FIX</span> <span class="badge bg-warning" id="timespan">TIME</span></td>
      </tr>
      <tr>
        <th scope="row">GPS Time:</th>
        <td id="gpstimecell">Unknown</td>
      </tr>
      <tr>
        <th scope="row">GPS Location:</th>
        <td id="gpsloccell">Unknown</td>
      </tr>
      <tr>
        <th scope="row">GPS Timezone:</th>
        <td id="gpstzcell">Unknown</td>
      </tr>      
    </table>
  </div>
</div>
{% endblock %}